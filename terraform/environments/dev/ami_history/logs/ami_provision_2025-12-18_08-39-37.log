[2025-12-18_08-39-37] Starting AMI provision (baseline update and hardening)...
[2025-12-18_08-39-37] Installing community.aws Ansible collection...
Starting galaxy collection install process
Nothing to do. All requested collections are already installed. If you want to reinstall them, consider using `--force`.
[2025-12-18_08-39-37] Finding newest running instance ID...
[2025-12-18_08-39-37] Running instances: i-00edad5cfa2211548
[2025-12-18_08-39-37] Selected newest running Instance ID: i-00edad5cfa2211548
[2025-12-18_08-39-37] Running Ansible prepare-golden-ami.yml via SSM...
2025-12-18 08:39:40,235 p=10704 u=sky n=ansible INFO| ansible-playbook [core 2.18.6]
  config file = /home/sky/AWS/terraform/ansible/ansible-ami.cfg
  configured module search path = ['/home/sky/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /home/sky/ansible-venv/lib/python3.12/site-packages/ansible
  ansible collection location = /home/sky/.ansible/collections:/usr/share/ansible/collections
  executable location = /home/sky/ansible-venv/bin/ansible-playbook
  python version = 3.12.3 (main, Nov  6 2025, 13:44:16) [GCC 13.3.0] (/home/sky/ansible-venv/bin/python3)
  jinja version = 3.1.6
  libyaml = True
2025-12-18 08:39:40,235 p=10704 u=sky n=ansible INFO| Using /home/sky/AWS/terraform/ansible/ansible-ami.cfg as config file
2025-12-18 08:39:40,338 p=10704 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:39:40,368 p=10704 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:39:40,369 p=10704 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:39:40,371 p=10704 u=sky n=ansible INFO| redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
2025-12-18 08:39:40,371 p=10704 u=sky n=ansible INFO| [DEPRECATION WARNING]: community.general.yaml has been deprecated. The plugin
has been superseded by the the option `result_format=yaml` in callback plugin
ansible.builtin.default from ansible-core 2.13 onwards. This feature will be
removed from community.general in version 13.0.0. Deprecation warnings can be
disabled by setting deprecation_warnings=False in ansible.cfg.
2025-12-18 08:39:40,371 p=10704 u=sky n=ansible INFO| redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
2025-12-18 08:39:40,391 p=10704 u=sky n=ansible INFO| Skipping callback 'default', as we already have a stdout callback.
2025-12-18 08:39:40,391 p=10704 u=sky n=ansible INFO| Skipping callback 'minimal', as we already have a stdout callback.
2025-12-18 08:39:40,391 p=10704 u=sky n=ansible INFO| Skipping callback 'oneline', as we already have a stdout callback.
2025-12-18 08:39:40,391 p=10704 u=sky n=ansible INFO| PLAYBOOK: prepare-golden-ami.yml ***********************************************
2025-12-18 08:39:40,391 p=10704 u=sky n=ansible INFO| 1 plays in ansible/playbooks/prepare-golden-ami.yml
2025-12-18 08:39:40,392 p=10704 u=sky n=ansible INFO| PLAY [Prepare Golden AMI (baseline update and hardening)] **********************
2025-12-18 08:39:40,398 p=10704 u=sky n=ansible INFO| TASK [Gathering Facts] *********************************************************
2025-12-18 08:39:40,398 p=10704 u=sky n=ansible INFO| task path: /home/sky/AWS/terraform/ansible/playbooks/prepare-golden-ami.yml:2
ansible-playbook [core 2.18.6]
  config file = /home/sky/AWS/terraform/ansible/ansible-ami.cfg
  configured module search path = ['/home/sky/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /home/sky/ansible-venv/lib/python3.12/site-packages/ansible
  ansible collection location = /home/sky/.ansible/collections:/usr/share/ansible/collections
  executable location = /home/sky/ansible-venv/bin/ansible-playbook
  python version = 3.12.3 (main, Nov  6 2025, 13:44:16) [GCC 13.3.0] (/home/sky/ansible-venv/bin/python3)
  jinja version = 3.1.6
  libyaml = True
Using /home/sky/AWS/terraform/ansible/ansible-ami.cfg as config file
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
Skipping callback 'default', as we already have a stdout callback.
Skipping callback 'minimal', as we already have a stdout callback.
Skipping callback 'oneline', as we already have a stdout callback.

PLAYBOOK: prepare-golden-ami.yml ***********************************************
1 plays in ansible/playbooks/prepare-golden-ami.yml

PLAY [Prepare Golden AMI (baseline update and hardening)] **********************

TASK [Gathering Facts] *********************************************************
task path: /home/sky/AWS/terraform/ansible/playbooks/prepare-golden-ami.yml:2
2025-12-18 08:39:40,510 p=10715 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:39:40,577 p=10704 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 0, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 0 seconds
2025-12-18 08:39:40,584 p=10715 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:39:40,642 p=10704 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 1, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 1 seconds
2025-12-18 08:39:41,651 p=10715 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:39:41,704 p=10704 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 2, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 3 seconds
2025-12-18 08:39:44,736 p=10715 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:39:44,782 p=10704 u=sky n=ansible INFO| An exception occurred during task execution. To see the full traceback, use -vvv. The error was: TypeError: expected string or bytes-like object, got 'NoneType'
2025-12-18 08:39:44,782 p=10704 u=sky n=ansible INFO| fatal: [i-00edad5cfa2211548]: FAILED! =>
  msg: 'Unexpected failure during module execution: expected string or bytes-like object, got ''NoneType'''
  stdout: ''
2025-12-18 08:39:44,783 p=10704 u=sky n=ansible INFO| PLAY RECAP *********************************************************************
2025-12-18 08:39:44,783 p=10704 u=sky n=ansible INFO| i-00edad5cfa2211548        : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
<i-00edad5cfa2211548> ssm_retry: attempt: 0, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 0 seconds
<i-00edad5cfa2211548> ssm_retry: attempt: 1, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 1 seconds
<i-00edad5cfa2211548> ssm_retry: attempt: 2, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible `"&& mkdir "` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" && echo ansible-tmp-1766039980.5004492-10715-278353645928551="` echo /tmp/.ansible/ansible-tmp-1766039980.5004492-10715-278353645928551 `" )...),pausing for 3 seconds
An exception occurred during task execution. To see the full traceback, use -vvv. The error was: TypeError: expected string or bytes-like object, got 'NoneType'
fatal: [i-00edad5cfa2211548]: FAILED! =>
  msg: 'Unexpected failure during module execution: expected string or bytes-like object, got ''NoneType'''
  stdout: ''

PLAY RECAP *********************************************************************
i-00edad5cfa2211548        : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
