[2025-06-11_10-33-01] Starting AMI provision (baseline update and hardening)...
[2025-06-11_10-33-01] Finding instance IP and ID...
[2025-06-11_10-33-01] Found Instance ID: i-05e9d73fe062fa8d7, IP: 63.32.52.36
[2025-06-11_10-33-01] Created ansible inventory: ansible/inventory/golden-ami-ssh.yaml
[2025-06-11_10-33-01] Running Ansible prepare-golden-ami.yml...

PLAY [Prepare Golden AMI (baseline update and hardening)] **********************

TASK [Gathering Facts] *********************************************************
ok: [golden-ami-instance]

TASK [Update apt cache] ********************************************************
changed: [golden-ami-instance]

TASK [Upgrade all packages (dist-upgrade)] *************************************
changed: [golden-ami-instance]

TASK [Install hardening packages] **********************************************
changed: [golden-ami-instance]

TASK [Ensure UFW allows HTTP/HTTPS (SSH not required for public access)] *******
changed: [golden-ami-instance] => (item=Nginx Full)

TASK [Ensure UFW allows SSH access (port 22)] **********************************
changed: [golden-ami-instance]

TASK [Explicitly enable UFW firewall] ******************************************
changed: [golden-ami-instance]

TASK [Ensure /run/sshd directory exists for privilege separation] **************
changed: [golden-ami-instance]

TASK [Disable SSH root login] **************************************************
changed: [golden-ami-instance]

TASK [Disable SSH password authentication] *************************************
changed: [golden-ami-instance]

TASK [Clean up /etc/environment from sensitive variables] **********************
ok: [golden-ami-instance]

TASK [Clear bash history for root] *********************************************
ok: [golden-ami-instance]

TASK [Autoremove and clean apt cache (final cleanup)] **************************
ok: [golden-ami-instance]

TASK [Reboot the server to apply updates and changes (with wait)] **************
changed: [golden-ami-instance]

RUNNING HANDLER [Restart SSH] **************************************************
changed: [golden-ami-instance]

PLAY RECAP *********************************************************************
golden-ami-instance        : ok=15   changed=11   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

[2025-06-11_10-33-01] Provisioning done. Now verify instance and run make create-ami ENV=dev
