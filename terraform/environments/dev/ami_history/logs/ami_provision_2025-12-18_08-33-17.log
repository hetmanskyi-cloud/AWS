[2025-12-18_08-33-17] Starting AMI provision (baseline update and hardening)...
[2025-12-18_08-33-17] Installing community.aws Ansible collection...
Starting galaxy collection install process
Nothing to do. All requested collections are already installed. If you want to reinstall them, consider using `--force`.
[2025-12-18_08-33-17] Finding newest running instance ID...
[2025-12-18_08-33-17] Running instances: i-00edad5cfa2211548
[2025-12-18_08-33-17] Selected newest running Instance ID: i-00edad5cfa2211548
[2025-12-18_08-33-17] Running Ansible prepare-golden-ami.yml via SSM...
2025-12-18 08:33:20,998 p=9011 u=sky n=ansible INFO| ansible-playbook [core 2.18.6]
  config file = /home/sky/AWS/terraform/ansible/ansible-ami.cfg
  configured module search path = ['/home/sky/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /home/sky/ansible-venv/lib/python3.12/site-packages/ansible
  ansible collection location = /home/sky/.ansible/collections:/usr/share/ansible/collections
  executable location = /home/sky/ansible-venv/bin/ansible-playbook
  python version = 3.12.3 (main, Nov  6 2025, 13:44:16) [GCC 13.3.0] (/home/sky/ansible-venv/bin/python3)
  jinja version = 3.1.6
  libyaml = True
2025-12-18 08:33:20,998 p=9011 u=sky n=ansible INFO| Using /home/sky/AWS/terraform/ansible/ansible-ami.cfg as config file
2025-12-18 08:33:21,140 p=9011 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:33:21,202 p=9011 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:33:21,202 p=9011 u=sky n=ansible INFO| redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
2025-12-18 08:33:21,205 p=9011 u=sky n=ansible INFO| redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
2025-12-18 08:33:21,205 p=9011 u=sky n=ansible INFO| [DEPRECATION WARNING]: community.general.yaml has been deprecated. The plugin
has been superseded by the the option `result_format=yaml` in callback plugin
ansible.builtin.default from ansible-core 2.13 onwards. This feature will be
removed from community.general in version 13.0.0. Deprecation warnings can be
disabled by setting deprecation_warnings=False in ansible.cfg.
2025-12-18 08:33:21,205 p=9011 u=sky n=ansible INFO| redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
2025-12-18 08:33:21,231 p=9011 u=sky n=ansible INFO| Skipping callback 'default', as we already have a stdout callback.
2025-12-18 08:33:21,231 p=9011 u=sky n=ansible INFO| Skipping callback 'minimal', as we already have a stdout callback.
2025-12-18 08:33:21,231 p=9011 u=sky n=ansible INFO| Skipping callback 'oneline', as we already have a stdout callback.
2025-12-18 08:33:21,231 p=9011 u=sky n=ansible INFO| PLAYBOOK: prepare-golden-ami.yml ***********************************************
2025-12-18 08:33:21,231 p=9011 u=sky n=ansible INFO| 1 plays in ansible/playbooks/prepare-golden-ami.yml
2025-12-18 08:33:21,232 p=9011 u=sky n=ansible INFO| PLAY [Prepare Golden AMI (baseline update and hardening)] **********************
2025-12-18 08:33:21,251 p=9011 u=sky n=ansible INFO| TASK [Gathering Facts] *********************************************************
2025-12-18 08:33:21,251 p=9011 u=sky n=ansible INFO| task path: /home/sky/AWS/terraform/ansible/playbooks/prepare-golden-ami.yml:2
ansible-playbook [core 2.18.6]
  config file = /home/sky/AWS/terraform/ansible/ansible-ami.cfg
  configured module search path = ['/home/sky/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /home/sky/ansible-venv/lib/python3.12/site-packages/ansible
  ansible collection location = /home/sky/.ansible/collections:/usr/share/ansible/collections
  executable location = /home/sky/ansible-venv/bin/ansible-playbook
  python version = 3.12.3 (main, Nov  6 2025, 13:44:16) [GCC 13.3.0] (/home/sky/ansible-venv/bin/python3)
  jinja version = 3.1.6
  libyaml = True
Using /home/sky/AWS/terraform/ansible/ansible-ami.cfg as config file
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: modules) ansible.builtin.ufw to community.general.ufw
redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
redirecting (type: callback) ansible.builtin.yaml to community.general.yaml
Skipping callback 'default', as we already have a stdout callback.
Skipping callback 'minimal', as we already have a stdout callback.
Skipping callback 'oneline', as we already have a stdout callback.

PLAYBOOK: prepare-golden-ami.yml ***********************************************
1 plays in ansible/playbooks/prepare-golden-ami.yml

PLAY [Prepare Golden AMI (baseline update and hardening)] **********************

TASK [Gathering Facts] *********************************************************
task path: /home/sky/AWS/terraform/ansible/playbooks/prepare-golden-ami.yml:2
2025-12-18 08:33:21,443 p=9022 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:33:21,632 p=9011 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 0, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 0 seconds
2025-12-18 08:33:21,639 p=9022 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:33:21,698 p=9011 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 1, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 1 seconds
2025-12-18 08:33:22,708 p=9022 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:33:22,759 p=9011 u=sky n=ansible INFO| <i-00edad5cfa2211548> ssm_retry: attempt: 2, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 3 seconds
2025-12-18 08:33:25,785 p=9022 u=sky n=botocore.credentials INFO| Found credentials in shared credentials file: ~/.aws/credentials
2025-12-18 08:33:25,845 p=9011 u=sky n=ansible INFO| An exception occurred during task execution. To see the full traceback, use -vvv. The error was: TypeError: expected string or bytes-like object, got 'NoneType'
2025-12-18 08:33:25,845 p=9011 u=sky n=ansible INFO| fatal: [i-00edad5cfa2211548]: FAILED! =>
  msg: 'Unexpected failure during module execution: expected string or bytes-like object, got ''NoneType'''
  stdout: ''
2025-12-18 08:33:25,846 p=9011 u=sky n=ansible INFO| PLAY RECAP *********************************************************************
2025-12-18 08:33:25,846 p=9011 u=sky n=ansible INFO| i-00edad5cfa2211548        : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
<i-00edad5cfa2211548> ssm_retry: attempt: 0, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 0 seconds
<i-00edad5cfa2211548> ssm_retry: attempt: 1, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 1 seconds
<i-00edad5cfa2211548> ssm_retry: attempt: 2, caught exception(expected string or bytes-like object, got 'NoneType')from cmd (( umask 77 && mkdir -p "` echo /tmp/.ansible-${USER} `"&& mkdir "` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" && echo ansible-tmp-1766039601.4321344-9022-136923711093195="` echo /tmp/.ansible-${USER}/ansible-tmp-1766039601.4321344-9022-136923711093195 `" )...),pausing for 3 seconds
An exception occurred during task execution. To see the full traceback, use -vvv. The error was: TypeError: expected string or bytes-like object, got 'NoneType'
fatal: [i-00edad5cfa2211548]: FAILED! =>
  msg: 'Unexpected failure during module execution: expected string or bytes-like object, got ''NoneType'''
  stdout: ''

PLAY RECAP *********************************************************************
i-00edad5cfa2211548        : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0

[2025-12-18_08-33-17] Provisioning done. Now verify instance and run make create-ami ENV=dev
